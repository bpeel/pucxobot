General notes
=============

The protocol is based on the WebSocket protocol. Once a WebSocket
connection is established, each end sends messages that correspond to
WebSocket messages. Each message begins with a single byte
containining the message ID. After that is the payload. The contents
of the payload depends on the message type, as described below. Each
message must be exactly sized to contain the message ID + the payload,
ie, there can be no extra data at the end of the message.

All numbers are in little-endian.

A player in the game is distinct from the network connection. The
intention is that if the connection is dropped then the client can
reconnect and recover without creating a new player. Instead a player
is identified by a 64-bit ID which is randomly generated by the
server. When connecting the client can either request a new player or
it can send this ID in order to continue with a previous player.

Strings are sent as NULL-terminated UTF-8 text.

Messages to the server
======================

The client initiates the communication by sending one of the following
messages:

NEW_PLAYER (0x80)
-----------------

• string name
• string game_type

This should be sent when the client first starts and hasn't tried
connecting before. The server will create a player ID and send it in a
PLAYER_ID message.

RECONNECT (0x81)
----------------

• uint64_t player_id
• uint16_t n_messages_received

This should be sent if the connection is dropped in order to resume.
The player_id must be a valid ID given from a previous PLAYER_ID
message from the server. num_messages_received should be the number of
messages that the client successfully received from a previous
connection. The server will continue sending messages from that point
on.

BUTTON (0x82)
----------------------

• The data of a button to be pressed. The data to placed here can be
  retrieved from the MESSAGE message.

KEEP_ALIVE (0x83)
-----------------

• No payload

Some data must be sent by the client at least every minute or the
server will close the connection. If nothing else needs to be sent the
client can send this empty message. No response is sent.

LEAVE (0x84)
------------

Leave the current game. It is meant as a friendly way for the client
to inform the server that the player has gone such as by closing the
browser tab. A message will be sent to the game to inform everyone
that the player has left and no further messages will be sent to any
connections listening to this player, even historical ones.

SEND_MESSAGE (0x85)
-------------------

• string text

Send a message to the chat

Messages to the client
======================

PLAYER_ID (0x00)
----------------

• uint64_t player_id

This is sent as the first message in response to a NEW_PLAYER command
in order to report the player's ID. If the player instead sends a
RECONNECT message this won't be sent unless the player was lost in
which case a new player ID will be generated. Therefore the client
should be prepared to update its player ID whenever this message is
received.

MESSAGE (0x01)
--------------

• uint8_t message flags
  bit 0: Set if the message is HTML, otherwise plain text
  bits 1-2: Message type:
             0: Public message
             1: Private message sent only to the player
             2: Chat message from another player
             3: Chat message from yourself
• string text

Following the text is a list of buttons terminated until the end of
the payload.

• string data – The data to send to press this button
• string text – The text to display on the button
